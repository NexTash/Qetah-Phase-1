{% extends "templates/primary.html" %}

{% block title %} QETAH | Checkout {% endblock %}

{% block content %}
<h2>Latest Order Details</h2>
<div id="order-summary">
  <p>Loading the latest delivery information...</p>
</div>

<script>
  frappe.call({
    method: "qetah_phase_1.events.order_test.get_latest_order_summary", // Create this method in the backend
    callback: function (response) {
      if (response.message) {
        let latest_delivery = response.message;
        let orderItemsHtml = '<h3>Customer: ' + latest_delivery.full_name + '</h3>' +
          '<p>Phone: ' + latest_delivery.phone + '</p>' +
          '<p>Address: ' + latest_delivery.address + ', ' + latest_delivery.city + ', ' + latest_delivery.state + '</p>' +
          '<h4>Order Items:</h4>';
        latest_delivery.order_items.forEach(item => {
          orderItemsHtml += '<div class="child-item">' +
            '<p>Product: <b>' + item.title + '</b></p>' +
            '<p>Quantity: <b>' + item.qty + '</b></p>' +
            '</div>';
        });
        document.getElementById('order-summary').innerHTML = orderItemsHtml;
      } else {
        document.getElementById('order-summary').innerHTML = '<p>No delivery information available.</p>';
      }
    }
  });
</script>
{% endblock %}