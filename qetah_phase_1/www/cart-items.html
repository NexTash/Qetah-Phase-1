{% extends "templates/primary.html" %}

{% block title %} QETAH | Cart Items {% endblock %}

{% block content %}

<!-- Student Header -->
<div class="content-area" :class="{'shifted-content': isStatic}">
  <div class="container cart">
    <div class="row row-col-2">
      <div class="col">
        <div class="cart-product">
          <div class="card card-webinar">
            <div class="card-head select-items">
              <span>
                <label class="check check-secondary"><input type="checkbox" /> Select All (7 item(s))</label>
              </span>
              <button class="btn btn-light btn-icon">
                <i class="bx bx-trash icon-pre"></i> Delete 
              </button>
            </div>
          </div>

          <!-- <h1>Your Cart</h1> -->
          <div class="cart-container">
            <!-- Cart items will be dynamically inserted here -->
          </div>
        </div>

      </div>
      <div class="col">
        <div class="card card-summary">
          <div class="card-head">
            <div class="location">
              <span>Location</span>
            </div>
            <div class="container model-container" x-data="{ isOpen: false }"
              x-init="$watch('isOpen', value => { document.body.style.overflow = value ? 'hidden' : 'auto';})">
              <button class="btn btn-secondary btn-icon model-btn" x-on:click="isOpen = true"><i
                  class="bx bx-location-plus icon-pre"></i> Add Shipping Address </button>
              <div class="modal active" x-show="isOpen" x-transition style="display: none;">
                <div class="modal-dialog" @click.away="isOpen = false">
                  <div class="modal-content ">
                    <div class="modal-head">
                      <h3 class="modal-title">Add Shipping Details</h3>
                    </div>
                    <div class="modal-body">
                      <div class="form-field">
                        <label class="field-label">First Name</label>
                        <div class="field">
                          <input type="text" class="field-text" placeholder="Enter first name" id="firstname" />
                        </div>
                      </div>
                      <div class="form-field">
                        <label class="field-label">Last Name</label>
                        <div class="field">
                          <input type="text" class="field-text" placeholder="Enter last name" id="lastname" />
                        </div>
                      </div>
                      <div class="form-field">
                        <label class="field-label">Phone No</label>
                        <div class="field">
                          <input type="text" class="field-text" placeholder="Enter your phone number" id="phone" />
                        </div>
                      </div>
                      <div class="form-field">
                        <label class="field-label">Address</label>
                        <div class="field">
                          <input type="text" class="field-text" placeholder="Enter your Address" id="address" />
                        </div>
                      </div>
                      <div class="form-field">
                        <label class="field-label">Email</label>
                        <div class="field">
                          <input type="email" class="field-text" placeholder="Enter your email" id="email" />
                        </div>
                      </div>

                      <div class="form-field">
                        <label class="field-label">State</label>
                        <div class="field">
                          <input type="text" class="field-text" placeholder="Enter your state" id="state" />
                        </div>
                      </div>
                      <div class="form-field">
                        <label class="field-label">City</label>
                        <div class="field">
                          <input type="text" class="field-text" placeholder="Enter your City" id="city" />
                        </div>
                      </div>
                      <div class="form-field">
                        <label class="field-label">Zip / Postal code</label>
                        <div class="field">
                          <input type="text" class="field-text" placeholder="Enter your Code" id="postalcode" />
                        </div>
                      </div>
                    </div>
                    <div class="modal-foot">
                      <button class="btn" x-on:click="isOpen = false">Cancel</button>
                      <button class="btn btn-secondary" id="saveButton">Save</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>


            <script>
              function displayData() {
                const data = JSON.parse(localStorage.getItem('shippingDetails'));

                // Log the retrieved data to the console
                console.log('Retrieved data from localStorage:', data);

                if (data) {
                  const displayDiv = document.getElementById('displayData');
                  displayDiv.innerHTML = `
                <!-- Target div where the data will be displayed -->
                <div id="displayData"></div>
                <p class="badge badge-sm badge-secondary badge-pill badge-sm">Home</p>
                <p class="media-title">${data.firstname} ${data.lastname}</p>
                <p class="media-subtitle txt-sm fw-500">${data.phone}</p>

                <h6 class="text-ellipsis text-ellipsis-2 txt-sm">
                ${data.address}
                </h6>`;
                } else {
                  console.log('No data found in localStorage');
                }
              }

              // Call displayData function on page load
              document.addEventListener('DOMContentLoaded', function () {
                displayData();
              });
            </script>

            <div class="media">
              <div class="media-head">
                <i class="bx bxs-user"></i>
              </div>
              <div class="media-body">
                <!-- Target div where the data will be displayed -->
                <div id="displayData"></div>
                <!-- <p class="badge badge-sm badge-secondary badge-pill badge-sm">Home</p>
                <p class="media-title">Ammar Shahid</p>
                <p class="media-subtitle txt-sm fw-500">04165651763</p>
                <h6 class="text-ellipsis text-ellipsis-2 txt-sm">
                  <strong>Two Line Truncation</strong>text trancate loremThis component truncates text with an ellipsis
                  (...)
                  when it exceeds the width of its container, useful for displaying long text in a limited space.Lorem
                  ipsum dolor
                  sit amet, consectetur adipiscing elit. Quisque ut risus sit amet nisl suscipit condimentum.Lorem ipsum
                  dolor sit amet, consectetur adipiscing elit. Quisque ut risus sit amet nisl suscipit condimentum.
                </h6> -->
              </div>
              <div class="media-foot">
                <label class="check check-dark"> <input type="checkbox" required /></label>
              </div>
            </div>
          </div>
          <hr>
          <div class="card-body">
            <div class="card-summary">
              <div id="updateOffcanvas"></div>
              <h2>Order Summary</h2>
              <div class="summary-content">
                <p class="summary-name">Subtotal <span id="item-count">0</span></p>
                <span class="summary-value">$ <span id="subtotal" ></span></span>
              </div>
              <!-- <div class="summary-content">
                <p class="summary-name">Subtotal (4 items)</p>
                <span class="summary-value">Rs. 3,139</span>
              </div> -->
              <div class="voucher">
                <div class="voucher-input-control">
                  <span class="field">
                    <input type="text" class="field-text" placeholder="Enter Voucher Code" />
                  </span>
                  <button type="button" class="btn btn-secondary">
                    Submit
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div class="card-foot">
            <a href="/checkout" style="text-decoration: none;">
              <button class="btn btn-secondary btn-sm btn-block">
                Proceed To Checkout(5)
              </button>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="container products">
    <h1>Just For You</h1>
    <!-- Slider main container -->
    <div class="swiper product-slider">
      <!-- Additional required wrapper -->
      <div class="swiper-wrapper">
        <!-- Slides -->
        {% for product in products %}

        {% for variation in product.variations %}
        <div class="swiper-slide">
          <div class="products">
            <div class="badge badge-primary badge-pill">{{ variation.title }}</div>
            <div class="card product-card">
              <a href="/product">
                <div class="card-head">
                  <img class="card-image"
                    src="https://d2v5dzhdg4zhx3.cloudfront.net/web-assets/images/storypages/primary/ProductShowcasesampleimages/JPEG/Product+Showcase-1.jpg">
                </div>
                <div class="card-body">
                  <div class="card-title">{{ variation.intro }}</div>
                  <div class="card-desc text-ellipsis text-ellipsis-2">
                    {{ variation.description }}
                  </div>
                  <div class="card-subtitle"><del>USD {{ variation.price }}</del></div>
                  <div class="card-title">USD {{ variation.discount }}</div>
                  <div class="card-rating">
                    <i class="bx bxs-star"></i>
                    <span>{{ product.rating_count }}</span> ({{ product.sold }} Sold)
                  </div>
                </div>
              </a>
              <div class="card-foot">
                <button class="btn btn-light btn-icon btn-pill"><i class="bx bx-cart icon-pre"></i> Buy Now</button>
                <button class="btn btn-light btn-icon btn-circle bx bx-heart"></button>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
        {% endfor %}
      </div>
      <button class="slide-next btn btn-secondary btn-sm bx bx-right-arrow-alt"></button>
      <button class="slide-prev btn btn-secondary btn-sm bx bx-left-arrow-alt"></button>
    </div>
  </div>
  <!-- cart -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const offcanvas = document.getElementById('offcanvas-cart');
      const offcanvasBody = offcanvas.querySelector('.offcanvas-body-cart'); // Add this line to get the offcanvas body
      const badge = document.querySelector('.cart-badge'); // Update this selector if needed
      const deleteSelectedBtn = document.getElementById('del-cart');

      let wishlist = [];

      function updateOffcanvas() {
        // Clear the current items
        offcanvasBody.innerHTML = '';

        // Add each item in the wishlist to the offcanvas
        wishlist.forEach((item, index) => {
          const itemDiv = document.createElement('div');
          itemDiv.className = 'items d-flex';
          itemDiv.innerHTML = `
                <div class="check-item" >
                    <label class="check check-secondary">
                        <input type="checkbox" class="item-checkbox" data-index="${index}" />
                    </label>
                </div>
                <img src="${item.image}" alt="${item.title}" class="offcanvas-image" />
                <div class="text">
                    <p class="offcanvas-title text-ellipsis">${item.title}</p>
                    <div class="text-ellipsis text-ellipsis-2" style="font-size: 13px;margin-top: -10px;color: #626161;}">${item.desc}</div>
                     <div class="quantity-counter">
                    <p class="price update-price" data-price-per-item="${item.price}">${item.price}</p> 
                            <div class="counter">
            <button class="btn btn-light btn-circle btn-circle-sm bx bx-minus counter-decrement"></button>
            <input class="counter-value value" type="number" value="1" min="0" />
            <button class="btn btn-light btn-circle btn-circle-sm bx bx-plus counter-increment"></button>
        </div> 
         </div>
                    
                </div>
            `;
          offcanvasBody.appendChild(itemDiv);
        });

        // Update badge number
        badge.textContent = wishlist.length;
      }

      function addToWishlist(product) {
        // Add the product to the wishlist array
        wishlist.push(product);
        // Update the offcanvas display
        updateOffcanvas();
      }

      document.querySelectorAll('.btn-cart').forEach(button => {
        button.addEventListener('click', (e) => {
          const productCard = e.target.closest('.product-card');
          if (!productCard) return;

          // Get product details from the card
          const product = {
            title: productCard.querySelector('.card-title').innerText,
            image: productCard.querySelector('.card-image').src,
            desc: productCard.querySelector('.card-desc').innerText,
            price: productCard.querySelector('.card-price').innerText,
          };

          // Add product to wishlist
          addToWishlist(product);
        });
      });

      deleteSelectedBtn.addEventListener('click', () => {
        const checkboxes = offcanvasBody.querySelectorAll('.item-checkbox');

        // Iterate backward to safely remove items
        for (let i = checkboxes.length - 1; i >= 0; i--) {
          const checkbox = checkboxes[i];
          if (checkbox.checked) {
            const index = parseInt(checkbox.getAttribute('data-index'), 10);
            wishlist.splice(index, 1);
            checkbox.closest('.items').remove();
          }
        }

        updateOffcanvas();
      });
    });
  </script>

  <script>
    document.getElementById('saveButton').addEventListener('click', function () {
      const firstname = document.getElementById('firstname').value;
      const lastname = document.getElementById('lastname').value;
      const phone = document.getElementById('phone').value;
      const address = document.getElementById('address').value;
      const email = document.getElementById('email').value;
      const state = document.getElementById('state').value;
      const city = document.getElementById('city').value;
      const postalcode = document.getElementById('postalcode').value;
      const shippingDetails = {
        firstname,
        lastname,
        phone,
        address,
        email,
        state,
        city,
        postalcode
      };

      localStorage.setItem('shippingDetails', JSON.stringify(shippingDetails));

      // Log the data to the console
      console.log('Data saved to localStorage:', shippingDetails);

      // Display the data in another div
      displayData();
    });

    // Display the data on page load if available
    document.addEventListener('DOMContentLoaded', function () {
      displayData();
    });
  </script>
  <!-- Include your scripts -->
  <script src="cart.js"></script>
  {% endblock %}

  <!-- header-fixed