{% extends "templates/primary.html" %}

{% block title %} QETAH | Product Detail {% endblock %}

{% block content %}
<style>

#image-zoomer-box {
  max-width: 500px;
  height: auto;
  position: relative;
}

#image-1 {
  width: 100%;
  height: auto;
}

#image-zoomer-box:hover,
#image-zoomer-box:active {
  cursor: crosshair;
}

#image-zoomer-box:hover #image-2,
#image-zoomer-box:active #image-2 {
  opacity: 1;
}

#image-2 {
  width: 200px;
  height: 200px;
  position: absolute;
  background: no-repeat #fff;
  background-size: 300%;
  box-shadow: 0px 5px 10px -2px rgba(0, 0, 0, 0.3);
  pointer-events: none;
  opacity: 0;
  border: 3px solid whitesmoke;
  border-radius: 100%;
  transition: opacity 0.2s;
  z-index: 999;
}

</style>
<!-- sidebar start -->
<aside id="sidebar" class="sidebar-header" :class="{'static-sidebar': isStatic}" x-data="{ sidebarOpen: false }">
  <!-- Course Sidebar Header -->
  <header class="program-sidebar">

      <div class="sidebar-brand">
        <!-- Large Logo -->
        <a href="#" class="lg-logo" x-show="isStatic">
          <img src="/assets/qetah_phase_1/images/black-qetah-removebg-preview.png" width="100px" class="lg-img"
            alt="Logo" />
        </a>
        <!-- Small Logo -->
        <a href="#" class="sm-logo">
          <img src="/assets/qetah_phase_1/images/WhatsApp_Image_2024-08-08_at_13.44.53_b31d506f-removebg-preview.png"
            class="sm-img" alt="Responsive Logo" width="30px" />
        </a>
      </div>
    </div>
    <div class="sidebar-auth">
      <a href="/index" data-target="sidebar-tooltip" data-title="Home">
        <img src="/assets/qetah_phase_1/images/black-qetah-removebg-preview.png" class="logo-header" width="20px"
          height="20px" alt="" srcset="">
        <br>
      </a>
      <a href="/index" data-target="sidebar-tooltip" data-title="Home">
        <div class="auth-media ">
          <i class="bx bx-home"></i>
          <div class="auth-intro" x-show="isStatic" x-cloak>
            <h3 class="heading"><a href="/index">Home</a></h3>
          </div>
        </div>
      </a>
      <a href="">
        <hr style="height: 2px;border: none; background-color: rgb(150, 150, 150);">
        <span class="divider divider-text divider-secondary">About</span>
      </a>
      <a href="/story" data-target="sidebar-tooltip" data-title="Story">
        <div class="auth-media ">
          <i class="bx bx-book"></i>
          <div class="auth-intro" x-show="isStatic" x-cloak>
            <h3 class="heading"><a href="/story">Story</a></h3>
          </div>
        </div>
      </a>
      <a href="/Blogs" data-target="sidebar-tooltip" data-title="Blogs">
        <div class="auth-media">
          <i class="bx bx-spreadsheet"></i>
          <div class="auth-intro" x-show="isStatic" x-cloak>
            <h3 class="heading"><a href="/Blogs">Blogs</a></h3>
          </div>
        </div>
      </a>
      <a href="/contact-us" data-target="sidebar-tooltip" data-title="Contact Us">
        <div class="auth-media">
          <i class="bx bx-phone"></i>
          <div class="auth-intro" x-show="isStatic" x-cloak>
            <h3 class="heading">
              <a href="/contact-us">Contact Us</a>
            </h3>
          </div>
        </div>
      </a>
      <a href="">
        <hr style="height: 2px;border: none; background-color: rgb(150, 150, 150);">
        <span class="divider divider-text divider-secondary">About</span>
      </a>
      <a href="/product" data-target="sidebar-tooltip" data-title="Shop">
        <div class="auth-media sidebar-active">
          <i class="bx bx-store"></i>
          <div class="auth-intro" x-show="isStatic" x-cloak>
            <h3 class="heading"><a href="/product">Shop</a></h3>
          </div>
        </div>
      </a>

      <!-- Men's Collection Dropdown -->
      <div class="auth-media">
        <a href="/product" data-target="sidebar-tooltip" data-title="Men's collection">
          <i class="bx bx-male"></i>
        </a>
        <div class="auth-intro" x-show="isStatic" x-cloak>
          <div x-data="{ open: false }">
            <div @click="open = !open" class="cursor-pointer">
              <h6 class="text-center text-dark side-coll" style="cursor: pointer;font-size: 14px ; ">
                Men's Collection
              </h6>
              <i class="bx bx-chevron-down"></i>
            </div>
            <div class="drops" x-show="open" x-cloak>
              <ul class="ml-4">
                <li><a href="/product">Unstitched</a></li>
                <li><a href="/product">Readymade Clothes</a></li>
                <li><a href="/product">Accessories</a></li>
                <li><a href="/product">Perfumes</a></li>
                <li><a href="/product">Cutting, Stitching</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <!-- Women's Collection Dropdown -->
      <div class="auth-media">
        <a href="/product" data-target="sidebar-tooltip" data-title="Women's collection">
          <i class="bx bx-female"></i>
        </a>
        <div class="auth-intro" x-show="isStatic" x-cloak>
          <div x-data="{ open: false }">
            <div @click="open = !open" class="cursor-pointer">
              <h6 class="text-center text-dark side-coll" style="cursor: pointer;font-size: 14px;">
                Women's Collection
              </h6>
              <i class="bx bx-chevron-down"></i>
            </div>
            <div class="drops" x-show="open" x-cloak>
              <ul class="list ml-4">
                <li><a href="/product">Unstitched</a></li>
                <li><a href="/product">Readymade Clothes</a></li>
                <li><a href="/product">Accessories</a></li>
                <li><a href="/product">Perfumes</a></li>
                <li><a href="/product">Cutting, Stitching</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <a href="">
        <hr style="height: 2px;border: none; background-color: rgb(150, 150, 150);">
        <span class="divider divider-text divider-secondary">Cart</span>
      </a>
      <a href="/cart-items" data-target="sidebar-tooltip" data-title="Cart">
        <div class="auth-media">
          <i class="bx bx-cart"></i>
          <div class="auth-intro" x-show="isStatic" x-cloak>
            <h3 class="heading">
              <a href="/cart-items">Cart</a>
            </h3>
          </div>
        </div>
      </a>
      <div class="language">
        <a href="">
          <hr style="height: 2px;border: none; background-color: rgb(150, 150, 150);">
          <span class="divider divider-text divider-secondary">Languages</span>
        </a>
        <div class="field field-inline field-light">
          <select name="" id="" class="field-select" style="background-image: none !important;">
            <option value="Option">ENG</option>
            <option value="Option">ARA</option>
          </select>
        </div>
        <!-- Additional Sidebar Items -->
      </div>
    </div>
  </header>
  <!-- Course Sidebar Header End -->
</aside>
<!--/ Course Sidebar End -->
<div class="content-area" :class="{'shifted-content': isStatic}">
  <div class="container detailed-product">
    <div class="row row-col-2">
      <div class="row row-col-2 product-details">
        {% for product in products %}
        <div class="col product-image-area">
          <div class="images">
          
            <div class="product-image-group" id="thumbnails">
              {% for image in product.images %}
              <img src="{{ image.images }}" alt="Product Image" class="img thumbnail" data-target="img{{ loop.index }}" data-full="{{ image.images }}" />
              {% endfor %}
            </div>

            <div class="product-image" id="image-zoomer-box">
              {% for image in product.images %}
              <img id="img{{ loop.index }}" src="{{ image.images }}" alt="Main Product Image" class="img main-img detail-img" style="display: {{ 'block' if loop.first else 'none' }};"/>
              {% endfor %}
              <div id="image-2"></div>
            </div>


          </div>
        </div>
        <div class="col product-content-area">
          <div class="product-detail-content">
            <div class="product-head">
              {% if product.variations %}
              {% for variation in product.variations %}
              <p>{{ variation.intro }}</p>
              <h1 class="p-title">{{ variation.title }}</h1>
              <div class="product-body">
                <div class="content-body">
                  <h2 class="price-head"><span class="p-price">
                    $ {{ variation.price }}
                  </span><span class="hori">|</span>
                    <div class="badge badge-danger badge-pill">{{ product.category }}</div>
                  </h2>
                  <div class="content">
                    <div class="content-desc text-ellipsis text-ellipsis-3">{{ variation.description }}</div>
                  </div>
                  <div class="sizes">
                    <button class="btn btn-light btn-sm">sm</button>
                    <button class="btn btn-light btn-sm active">md</button>
                    <button class="btn btn-light btn-sm">lg</button>
                    <button class="btn btn-light btn-sm">xl</button>
                    <button class="btn btn-light btn-sm">xxl</button>
                  </div>
                  <div class="icon">
                    <i class="bx bx-cart"></i>
                    <p>{{ product.title }}</p>
                  </div>
                </div>
              </div>
              {% endfor %}
              {% else %}
              <p>No variations available</p>
              {% endif %}
            </div>
            <div class="product-foot">
              <div class="btn-group">
                <button id="addToCartBtn" class="btn btn-secondary btn-lg btn-icon">
                  <i class="bx bx-cart icon-pre"></i>Add To Cart
                </button>
                <button class="btn btn-light btn-lg btn-icon btn-heart">
                  <i class="bx bx-heart icon-pre"></i>Save To Wishlist
                </button>
              </div>
              <div class="icon-group">
                <button class="btn btn-light btn-circle btn-sm">
                  <i class="bx bxl-facebook"></i>
                </button>
                <button class="btn btn-light btn-circle btn-sm">
                  <i class="bx bxl-instagram"></i>
                </button>
                <button class="btn btn-light btn-circle btn-sm">
                  <i class="bx bxl-twitter"></i>
                </button>
                <button class="btn btn-light btn-circle btn-sm">
                  <i class="bx bxl-whatsapp"></i>
                </button>
                <button class="btn btn-light btn-circle btn-sm">
                  <i class="bx bxl-gmail"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
        <div class="product-details-content">
          {{ product.description }}
        </div>
        {% endfor %}
      </div>
</div>
      <div class="container products">
        <h1 class="text-start">Related Product</h1>
        <!-- Slider main container -->
        <div class="swiper product-slider">
          <!-- Additional required wrapper -->
          <div class="swiper-wrapper">
            <!-- Slides -->
            {% for product in products %}

            {% for variation in product.variations %}
            <div class="swiper-slide">
              <div class="products">
                <div class="badge badge-primary badge-pill">{{ variation.title }}</div>
                <div class="card product-card">
                  <a href="/product-detail?id={{product.name}}">
                    <div class="card-head">
                      <img class="card-image"
                        src="https://d2v5dzhdg4zhx3.cloudfront.net/web-assets/images/storypages/primary/ProductShowcasesampleimages/JPEG/Product+Showcase-1.jpg">
                    </div>
                    <div class="card-body">
                      <div class="card-title">{{ variation.intro }}</div>
                      <div class="card-desc text-ellipsis text-ellipsis-2">
                        {{ variation.description }}
                      </div>
                      <div class="card-subtitle"><del>USD {{ variation.price }}</del></div>
                      <div class="card-title">USD {{ variation.discount }}</div>
                      <div class="card-rating">
                        <i class="bx bxs-star"></i>
                        <span>{{ product.rating_count }}</span> ({{ product.sold }} Sold)
                      </div>
                    </div>
                  </a>
                  <div class="card-foot">
                    <button class="btn btn-light btn-icon btn-pill"><i class="bx bx-cart icon-pre"></i> Buy Now</button>
                    <button class="btn btn-light btn-icon btn-circle bx bx-heart btn-heart"></button>
                  </div>
                </div>


              </div>
            </div>

            {% endfor %}


            {% endfor %}

          </div>
          <button class="slide-next btn btn-secondary btn-sm bx bx-right-arrow-alt"></button>
          <button class="slide-prev btn btn-secondary btn-sm bx bx-left-arrow-alt"></button>
        </div>
      </div>
      <div class="container customer-reviews">
        <div class="badge badge-o-dark badge-pill">Reviews</div>
        <h1 class="text-center" data-aos="fade-up" data-aos-anchor-placement="center-center">What Our Customers Say</h1>
        <div class="border text-center"></div>
        <div class="slide-container text-center">
          <div class="swiper-wrapper">
            {% for testimonil in testimonils %}
            <div class="swiper-slide review-content">
              <p>{{testimonil.feedback}}</p>
              <h2 class="fw-bold reviewer-name">{{testimonil.full_name}}</h2>
              <i class="company-name">{{testimonil.designation}}</i>
            </div>
            {% endfor %}
          </div>
          <!-- Navigation buttons -->
          <div class="swiper-button-prev"></div>
          <div class="swiper-button-next"></div>
        </div>
      </div>

      {% endblock %}




      {% block scripts %}



      <!-- product -->
      <script>
        const thumbnails = document.querySelectorAll('.product-image-group .img');
        const largeImages = document.querySelectorAll('.product-image .main-img');

        thumbnails.forEach((thumbnail) => {
          thumbnail.addEventListener('click', function () {
            // Hide all large images
            largeImages.forEach((img) => {
              img.style.display = 'none';
            });

            // Show the large image that matches the clicked thumbnail's data-target
            const targetId = this.getAttribute('data-target');
            const targetImage = document.getElementById(targetId);
            if (targetImage) {
              targetImage.style.display = 'block';
            }
          });
        });
      </script>
      <!-- sizes -->
      <script>
        const sizeButtons = document.querySelectorAll('.sizes .btn');

        sizeButtons.forEach((button) => {
          button.addEventListener('click', function () {
            // Remove the 'active' class from all buttons
            sizeButtons.forEach((btn) => btn.classList.remove('active'));

            // Add the 'active' class to the clicked button
            this.classList.add('active');
          });
        });
      </script>
    <!-- cart -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
      const offcanvas = document.getElementById('offcanvas-cart');
      const offcanvasBody = offcanvas.querySelector('.offcanvas-body-cart'); // Add this line to get the offcanvas body
      const badge = document.querySelector('.cart-badge'); // Update this selector if needed
      const deleteSelectedBtn = document.getElementById('del-cart');

      let wishlist = [];

      function updateOffcanvas() {
          // Clear the current items
          offcanvasBody.innerHTML = '';

          // Add each item in the wishlist to the offcanvas
          wishlist.forEach((item, index) => {
              const itemDiv = document.createElement('div');
              itemDiv.className = 'items d-flex';
              itemDiv.innerHTML = `
              <div class="check-item">
                  <label class="check check-secondary">
                      <input type="checkbox" class="item-checkbox" data-index="${index}" />
                  </label>
              </div>
              <img src="${item.image}" alt="${item.title}" class="offcanvas-image" />
              <div class="text">
                  <p class="offcanvas-title text-ellipsis">${item.title}</p>
                  <div class="text-ellipsis text-ellipsis-2" style="font-size: 13px;margin-top: -10px;color: #626161;}">${item.desc}</div>
                   <div class="quantity-counter">
                  <p class="price">${item.price}</p>
                          <div class="counter">
          <button class="btn btn-light btn-circle btn-circle-sm bx bx-minus counter-decrement"></button>
          <input class="counter-value value" type="number" value="0" min="0" />
          <button class="btn btn-light btn-circle btn-circle-sm bx bx-plus counter-increment"></button>
      </div> 
                        </div>
                  
              </div>
          `;
              offcanvasBody.appendChild(itemDiv);
          });

          // Update badge number
          badge.textContent = wishlist.length;
      }

      function addToWishlist(product) {
          // Add the product to the wishlist array
          wishlist.push(product);
          // Update the offcanvas display
          updateOffcanvas();
      }

      document.querySelectorAll('.btn-cart').forEach(button => {
          button.addEventListener('click', (e) => {
              const productCard = e.target.closest('.product-card');
              if (!productCard) return;

              // Get product details from the card
              const product = {
                  title: productCard.querySelector('.card-title').innerText,
                  image: productCard.querySelector('.card-image').src,
                  desc: productCard.querySelector('.card-desc').innerText,
                  price: productCard.querySelector('.card-price').innerText,
              };

              // Add product to wishlist
              addToWishlist(product);
          });
      });

      deleteSelectedBtn.addEventListener('click', () => {
          const checkboxes = offcanvasBody.querySelectorAll('.item-checkbox');

          // Iterate backward to safely remove items
          for (let i = checkboxes.length - 1; i >= 0; i--) {
              const checkbox = checkboxes[i];
              if (checkbox.checked) {
                  const index = parseInt(checkbox.getAttribute('data-index'), 10);
                  wishlist.splice(index, 1);
                  checkbox.closest('.items').remove();
              }
          }

          updateOffcanvas();
      });
  });
</script>
<!-- wishlist -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
      const offcanvas = document.getElementById('offcanvas');
      const offcanvasBody = offcanvas.querySelector('.offcanvas-body'); // Add this line to get the offcanvas body
      const badge = document.querySelector('.noti-badge'); // Update this selector if needed
      const deleteSelectedBtn = document.getElementById('deleteSelectedBtn');



      let wishlist = [];

      function updateOffcanvas() {
          // Clear the current items
          offcanvasBody.innerHTML = '';

          // Add each item in the wishlist to the offcanvas
          wishlist.forEach((item, index) => {
              const itemDiv = document.createElement('div');
              itemDiv.className = 'items d-flex';
              itemDiv.innerHTML = `
              <div class="check-item">
                  <label class="check check-secondary">
                      <input type="checkbox" class="item-checkbox" data-index="${index}" />
                  </label>
              </div>
              <img src="${item.image}" alt="${item.title}" class="offcanvas-image" />
              <div class="text">
                  <p class="offcanvas-title text-ellipsis">${item.title}</p>
                  <div class="text-ellipsis text-ellipsis-2" style="font-size: 13px;margin-top: -10px;color: #626161;}">${item.desc}</div>
                   <div class="badge badge-secondary mt-2">${item.size}</div>
                   <div class="quantity-counter">
                  <p class="price">${item.price}</p>
                          <div class="counter">
          <button class="btn btn-light btn-circle btn-circle-sm bx bx-minus counter-decrement"></button>
          <input class="counter-value value" type="number" value="0" min="0" />
          <button class="btn btn-light btn-circle btn-circle-sm bx bx-plus counter-increment"></button>
      </div> 
                        </div>
                  
              </div>
          `;
              offcanvasBody.appendChild(itemDiv);
          });
          badge.textContent = wishlist.length;
      }

      function addToWishlist(product) {
          // Add the product to the wishlist array
          wishlist.push(product);
          // Update the offcanvas display
          updateOffcanvas();
      }

      document.querySelectorAll('.btn-heart').forEach(button => {
          button.addEventListener('click', (e) => {
              const productCard = e.target.closest('.product-details');
              if (!productCard) return;

              // Get product details from the card
              const product = {
                  title: productCard.querySelector('.p-title').innerText,
                  image: productCard.querySelector('.detail-img').src,
                  desc: productCard.querySelector('.content-desc').innerText,
                  size: productCard.querySelector('.active').innerText,
                  price: productCard.querySelector('.p-price').innerText,
              };

              // Add product to wishlist
              addToWishlist(product);
          });
      });

      deleteSelectedBtn.addEventListener('click', () => {
          const checkboxes = offcanvasBody.querySelectorAll('.item-checkbox');
          const indicesToRemove = new Set();

          // Collect indices of checked checkboxes
          checkboxes.forEach(checkbox => {
              if (checkbox.checked) {
                  const index = parseInt(checkbox.getAttribute('data-index'), 10);
                  if (!isNaN(index)) {
                      indicesToRemove.add(index);
                  }
              }
          });

          // Remove items from wishlist based on collected indices
          indicesToRemove.forEach(index => {
              if (index >= 0 && index < wishlist.length) {
                  wishlist.splice(index, 1);
              }
          });

          // Remove items from the DOM
          checkboxes.forEach(checkbox => {
              if (checkbox.checked) {
                  const itemElement = checkbox.closest('.items');
                  if (itemElement) {
                      itemElement.remove();
                  }
              }
          });

          // Reindex wishlist and update data-index attributes
          updateOffcanvas();
      });


  });
</script>
<!-- zoomer img -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  const thumbnails = document.querySelectorAll(".thumbnail");
  const mainImage = document.querySelector(".main-img");
  const zoomBox = document.querySelector("#image-zoomer-box");
  const magnified = document.querySelector("#image-2");

  // Function to update the main image and set the zoom background
  function updateMainImage(src) {
    mainImage.src = src; // Update the main image source

    // Set the zoom background image with the correct path
    const zoomImagePath = `/files/${src.split('/').pop()}`; // Adds /files/ prefix
    magnified.style.backgroundImage = `url(${zoomImagePath})`;
    magnified.style.backgroundSize = "300%"; // Adjust as needed for zoom level
    magnified.style.backgroundPosition = "0% 0%"; // Reset background position
  }

  // Initial setup: Set zoom background to the first main image
  updateMainImage(mainImage.src);

  // Event listener for thumbnail clicks
  thumbnails.forEach(thumbnail => {
    thumbnail.addEventListener("click", function () {
      const fullImageSrc = this.getAttribute("data-full");
      updateMainImage(fullImageSrc); // Update the main image and zoomer on click
    });
  });

  // Event listener for zoom effect on hover
  zoomBox.addEventListener("mousemove", function (e) {
    // Ensure the main image and magnified background are properly updated
    const rect = mainImage.getBoundingClientRect();
    const x = e.clientX - rect.left; // Cursor's X position relative to the main image
    const y = e.clientY - rect.top;  // Cursor's Y position relative to the main image
    const imgWidth = mainImage.offsetWidth;
    const imgHeight = mainImage.offsetHeight;

    // Calculate percentage positions of the cursor within the main image
    const xPercent = (x / imgWidth) * 100;
    const yPercent = (y / imgHeight) * 100;

    // Dynamically update the background position to follow the cursor
    magnified.style.backgroundPosition = `${xPercent}% ${yPercent}%`;
    magnified.style.left = `${x - magnified.offsetWidth / 2}px`; // Center the zoomer horizontally
    magnified.style.top = `${y - magnified.offsetHeight / 2}px`; // Center the zoomer vertically
  });

  // Handle mouse enter and leave to show and hide the zoom effect
  zoomBox.addEventListener("mouseenter", function () {
    magnified.style.opacity = 1; // Show the zoom on hover
  });

  zoomBox.addEventListener("mouseleave", function () {
    magnified.style.opacity = 0; // Hide the zoom when the mouse leaves
  });
});
</script>
      {% endblock %}